<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vote in 16 Categories</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f8f9fa;
    }
    .category {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1rem;
      margin: 1.5rem 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .category h2 {
      margin-top: 0;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #888;
      background-color: #eee;
      cursor: pointer;
    }
    button:hover {
      background-color: #ddd;
    }
    button.voted {
      background-color: #cfc;
      border-color: #7c7;
      color: #333;
      pointer-events: none;
    }
    .voted-label {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>

  <h1>Vote in 16 Categories</h1>
  <p>Choose one of 6 options in each category. You can vote once per category.</p>

  <div id="categories-container"></div>

  <script>
    // Replace these with your Supabase project values
    const SUPABASE_URL = 'https://your-project-id.supabase.co';
    const SUPABASE_KEY = 'your-anon-key';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const categories = [
      "Best Music", "Best Game", "Best Meme", "Best Streamer",
      "Best Movie", "Best Series", "Best Clip", "Best Team",
      "Best Comeback", "Best Design", "Best Voice Line", "Best Fail",
      "Best Champion", "Best Skin", "Best Play", "Funniest Moment"
    ];

    const options = ["Option 1", "Option 2", "Option 3", "Option 4", "Option 5", "Option 6"];
    const votedKey = (category) => `voted_${category}`;

    function createVotingUI() {
      const container = document.getElementById("categories-container");
      container.innerHTML = ''; // clear old content

      categories.forEach(category => {
        const div = document.createElement("div");
        div.className = "category";

        const title = document.createElement("h2");
        title.textContent = category;
        div.appendChild(title);

        const voted = localStorage.getItem(votedKey(category));

        options.forEach(option => {
          const button = document.createElement("button");
          button.textContent = option;

          if (voted) {
            button.disabled = true;
            if (voted === option) {
              button.classList.add("voted");
            }
          } else {
            button.onclick = () => vote(category, option);
          }

          div.appendChild(button);
        });

        if (voted) {
          const label = document.createElement("div");
          label.className = "voted-label";
          label.textContent = `You voted: ${voted}`;
          div.appendChild(label);
        }

        container.appendChild(div);
      });
    }

    async function vote(category, option) {
      if (localStorage.getItem(votedKey(category))) {
        alert("You already voted in this category!");
        return;
      }

      const { error } = await supabase
        .from("votes")
        .insert([{ category, option }]);

      if (error) {
        alert("Error submitting vote!");
        console.error(error);
        return;
      }

      localStorage.setItem(votedKey(category), option);
      alert(`You voted for ${option} in "${category}"`);
      createVotingUI(); // re-render UI
    }

    createVotingUI();
  </script>
</body>
</html>

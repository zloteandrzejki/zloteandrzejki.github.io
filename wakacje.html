<!DOCTYPE html>
<html>
<head>
  <title>Voting App</title>
  <!-- Make sure Supabase is loaded FIRST -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

  <div id="categories-container"></div>

  <!-- Your code MUST go AFTER Supabase is loaded -->
<script>
  const SUPABASE_URL = 'https://frlaetburkjbprmrgmwr.supabase.co';
  const SUPABASE_KEY = 'your-key';
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const categories = ["Best Meme", "Best Game"]; // shortened for demo
    const options = ["Option 1", "Option 2", "Option 3", "Option 4", "Option 5", "Option 6"];
    const votedKey = (category) => `voted_${category}`;

    function createVotingUI() {
      const container = document.getElementById("categories-container");
      if (!container) return;

      container.innerHTML = '';

      categories.forEach(category => {
        const div = document.createElement("div");
        div.className = "category";

        const title = document.createElement("h2");
        title.textContent = category;
        div.appendChild(title);

        const voted = localStorage.getItem(votedKey(category));

        options.forEach(option => {
          const button = document.createElement("button");
          button.textContent = option;

          if (voted) {
            button.disabled = true;
            if (voted === option) {
              button.classList.add("voted");
            }
          } else {
            button.onclick = () => vote(category, option);
          }

          div.appendChild(button);
        });

        if (voted) {
          const label = document.createElement("div");
          label.className = "voted-label";
          label.textContent = `You voted: ${voted}`;
          div.appendChild(label);
        }

        container.appendChild(div);
      });
    }

    async function vote(category, option) {
      if (localStorage.getItem(votedKey(category))) {
        alert("Already voted");
        return;
      }

      const { error } = await supabase.from('votes').insert([{ category, option }]);

      if (error) {
        alert("Error submitting vote");
        return;
      }

      localStorage.setItem(votedKey(category), option);
      createVotingUI();
    }

    // Call after everything is defined
    createVotingUI();
  </script>
</body>
</html>
